# ' OR '1' = '1'の使用技術又実装方法

## 環境

BOT自体と新規のイベント検出、登録はPycordでBOT動かしながらやってます  
環境は Heroku(WebSub受け取り用サーバー) + AWS(Mysql) + clever(Redis) + 自宅サーバー(Pytyon + AWSのMysql用のExpressで作ったAPIサーバー)です。  
  Mysqlがイベント、権限等の情報を保持していてRedisがユーザーのサーバー内での権限を一時キャッシュしています。  
現在はYouTube,Twitch,Twitcastingが対応していると公表していますが  
実はSHOWROOM,BILIBILI,MILDOMも対応してます(お知らせとかのページに書かないのは後述)

## YouTubeの動画取得+ステータス表示

動画の取得に関してはYouTube Data APIのWebsubとvideosのAPI(今後/videos)を使用して、  
動画のIDをリストにして/videosにぶちこんで取得してます  
ステータス変更に関しては変更時にもWebSubに通知が来るのでその際に/videosのリストの中にぶちこんであげるだけです。

回す間隔は初期割当のクォータでも回せるように 

__動画数 / 50(一回に取得できる動画の数の上限) * 15__

で最低15秒間隔で回して、毎日1万クォータ中5千クォータの消費で収まってます。  
あとは僕が[Stackoverflowで質問して返してくださった回答を参考](https://ja.stackoverflow.com/questions/71614/youtube-data-api-%e3%81%8b%e3%82%89%e3%83%97%e3%83%ac%e3%83%9f%e3%82%a2%e5%85%ac%e9%96%8b-%e4%ba%88%e7%b4%84%e3%81%95%e3%82%8c%e3%81%9f%e3%83%a9%e3%82%a4%e3%83%96%e9%85%8d%e4%bf%a1%e3%82%92%e5%88%a4%e5%88%a5%e3%81%99%e3%82%8b%e6%96%b9%e6%b3%95%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6/78359#78359)
にして、  
プレミアか配信か動画か振り分けるようにして動画にステータスとして割り振ってます。  
過去の取得したりしてすでに終わってるやつとかは判別しようが無いので適当に配信かプレミア公開にしてます。  
しかたないね、今の仕様読み込んでないからわからんけど

## その他のプラットフォームの動画取得
TwitchとTwitcastingに関しては普通に何でも取得できるAPIがあるたそこで取得しています。  
SHOWROOM,BILIBILI,MILDOMはサイト内で見る際に取得するJSONファイルを読み込んでます。  
普通に開発者側用のものではなくユーザー用なので取得できる人数に制限があります  (制限を突破するとしばらく取得できなくなる)  
なのでほしい！って人にしか教えてません。

あとなんかPythonだとどうしてもMysql関連繋ごうとすると重いしasyncio対応のやつあった気がするけど理解できなかったため今の形になってます。　　
なんでだろね。
